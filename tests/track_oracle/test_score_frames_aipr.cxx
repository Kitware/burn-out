/*ckwg +5
 * Copyright 2010-2014 by Kitware, Inc. All Rights Reserved. Please refer to
 * KITWARE_LICENSE.TXT for licensing information, or contact General Counsel,
 * Kitware, Inc., 28 Corporate Drive, Clifton Park, NY 12065.
 */

#include <track_oracle/scoring_framework/score_frames_aipr.h>

#include <testlib/testlib_test.h>
#include <tracking_data/track.h>
#include <tracking_data/io/track_reader_process.h>

#include <vul/vul_arg.h>

#include <iomanip>
#include <fstream>
#include <map>
#include <vector>
#include <string>
#include <iostream>


using std::cerr;
using std::cout;
using std::endl;
using std::setprecision;
using std::string;
using std::vector;

using namespace vidtk;

int test_score_frames_aipr(int argc, char* argv[])
{
  if (argc < 2)
  {
    cerr << "Need the data directory as argument\n";
    return EXIT_FAILURE;
  }

  const char *ground_truth_files[10] =
  {
    "GroundTruth3BowieHeads1Star",
    "GroundTruth1Star",
    "GroundTruth3BowieHeads",
    "GroundTruthBlueGreenBowieHead",
    "GroundTruthRedGreenBowieHeads",
    "GroundTruthRedBlueBowieHead",
    "GroundTruthGreenBowieHead",
    "GroundTruthBlueBowieHead",
    "GroundTruthRedBowieHead",
    "GroundTruth0BowieHeads"
  };

  const char *computed_trk_files[10] =
  {
    "CompPerfect3BowieHeads1Star",
    "CompSplitTrackFalsePosAndFragmented",
    "CompRobustAIPRAssociationTest",
    "CompFragmentedAndSwitch",
    "Comp1TrackInStar",
    "CompPerfectGreenBowieHead",
    "Comp1TrackSwitchFromRedToBlue",
    "Comp1TrackFragmentedOverGreen",
    "Comp1TrackOnGreenFrame4to10",
    "Comp0Tracks",
  };

  double expected_values[100][16] = {
    //CompPerfect3BowieHeads1Star
    { 1.4038461538461537, 1.9615384615384615, 2.2307692307692308, 2.2307692307692308, 3.4230769230769229, 0, 0.40384615384615385, 1.6153846153846154, 2.2307692307692308, 1.6153846153846154, 2.2307692307692308, 1.9615384615384615, 1.9615384615384615, 0.40384615384615385, 5.0384615384615383, 7.2692307692307692}, //GroundTruth3BowieHeads1Star
    { 1, 1, 0, 2.4230769230769229, 1, 0, 0, 0, 0, 0.53846153846153844, 1, 0.37820512820512814, 0.37820512820512814, 0.53846153846153844, 1, 1}, //GroundTruth3BowieHeads1Star
    { 1.1923076923076925, 1.4230769230769231, 0.69230769230769229, 1.6923076923076923, 2.4230769230769229, 0, 0.23076923076923081, 0.69230769230769229, 0.69230769230769229, 1.0769230769230769, 1.2307692307692308, 1.1576923076923078, 1.1576923076923078, 0.35897435897435892, 3.1153846153846154, 3.8076923076923075}, //GroundTruth3BowieHeads1Star
    { 1.3076923076923077, 1.6538461538461537, 0.69230769230769229, 2.3846153846153846, 1.7307692307692308, 0, 0.34615384615384615, 0.69230769230769229, 0.69230769230769229, 1.0769230769230769, 1.2307692307692308, 0.95000000000000029, 0.95000000000000029, 0.53846153846153844, 2.4230769230769229, 3.1153846153846154}, //GroundTruth3BowieHeads1Star
    { 0.96153846153846156, 0.96153846153846156, 0, 1.7692307692307692, 1.6538461538461537, 0, 0, 0, 0, 0.5, 0.57692307692307687, 0.55128205128205132, 0.55128205128205132, 0.25, 1.6538461538461537, 1.6538461538461537}, //GroundTruth3BowieHeads1Star
    { 0.76923076923076927, 0.76923076923076927, 0, 1.9615384615384615, 1.4615384615384615, 0, 0, 0, 0, 0.57692307692307687, 0.65384615384615385, 0.46794871794871795, 0.46794871794871795, 0.28846153846153844, 1.4615384615384615, 1.4615384615384615}, //GroundTruth3BowieHeads1Star
    { 0.96153846153846156, 0.96153846153846156, 0, 2.4615384615384617, 0.96153846153846156, 0, 0, 0, 0, 0.5, 0.57692307692307687, 0.33653846153846156, 0.33653846153846156, 0.5, 0.96153846153846156, 0.96153846153846156}, //GroundTruth3BowieHeads1Star
    { 0.76923076923076927, 0.76923076923076927, 0, 2.6538461538461537, 0.76923076923076927, 0, 0, 0, 0, 0.57692307692307687, 0.65384615384615385, 0.24679487179487175, 0.24679487179487175, 0.57692307692307687, 0.76923076923076927, 0.76923076923076927}, //GroundTruth3BowieHeads1Star
    { 0.69230769230769229, 0.69230769230769229, 0, 2.7307692307692308, 0.69230769230769229, 0, 0, 0, 0, 0, 0, 0.17307692307692307, 0.17307692307692307, 0, 0.69230769230769229, 0.69230769230769229}, //GroundTruth3BowieHeads1Star
    { 0, 0, 0, 3.4230769230769229, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, //GroundTruth3BowieHeads1Star

    //CompSplitTrackFalsePosAndFragmented
    { 0.62179487179487181, 0.84294871794871784, 1.6923076923076923, 1.8846153846153846, 2.6153846153846154, 0.80769230769230771, 0.20833333333333331, 0.80769230769230771, 0.88461538461538458, 0.88461538461538458, 0.88461538461538458, 0.78076923076923077, 0.78076923076923077, 0.24679487179487178, 2.2692307692307692, 3.1538461538461537}, //GroundTruth1Star
    { 0.53846153846153844, 0.53846153846153844, 0.46153846153846156, 3.0769230769230771, 0.53846153846153844, 0.46153846153846156, 0, 0, 0, 0.26923076923076922, 0.26923076923076922, 0.12884615384615386, 0.12884615384615386, 0.26923076923076922, 0.53846153846153844, 0.53846153846153844}, //GroundTruth1Star
    { 0.80769230769230771, 0.83333333333333326, 0.42307692307692307, 1.6153846153846154, 2.0769230769230771, 0.34615384615384615, 0.02564102564102564, 0.076923076923076927, 0.076923076923076927, 0.61538461538461542, 0.61538461538461542, 0.62820512820512819, 0.62820512820512819, 0.23076923076923073, 2, 2.0769230769230771}, //GroundTruth1Star
    { 0.76923076923076927, 0.80769230769230771, 0.38461538461538464, 2.2692307692307692, 1.4230769230769231, 0.30769230769230771, 0.038461538461538464, 0.076923076923076927, 0.076923076923076927, 0, 0, 0.38974358974358975, 0.38974358974358975, 0, 1.3461538461538463, 1.4230769230769231}, //GroundTruth1Star
    { 0.88461538461538458, 0.88461538461538458, 0.15384615384615385, 2.1153846153846154, 1.5, 0.15384615384615385, 0, 0, 0, 0.61538461538461542, 0.61538461538461542, 0.48717948717948717, 0.48717948717948717, 0.36538461538461536, 1.5, 1.5}, //GroundTruth1Star
    { 0.61538461538461542, 0.61538461538461542, 0.23076923076923078, 2.3846153846153846, 1.2307692307692308, 0.23076923076923078, 0, 0, 0, 0.61538461538461542, 0.61538461538461542, 0.3461538461538462, 0.3461538461538462, 0.32692307692307693, 1.2307692307692308, 1.2307692307692308}, //GroundTruth1Star
    { 0.84615384615384615, 0.84615384615384615, 0.11538461538461539, 2.7692307692307692, 0.84615384615384615, 0.11538461538461539, 0, 0, 0, 0, 0, 0.27243589743589747, 0.27243589743589747, 0, 0.84615384615384615, 0.84615384615384615}, //GroundTruth1Star
    { 0.57692307692307687, 0.57692307692307687, 0.19230769230769232, 3.0384615384615383, 0.57692307692307687, 0.19230769230769232, 0, 0, 0, 0, 0, 0.12500000000000003, 0.12500000000000003, 0, 0.57692307692307687, 0.57692307692307687}, //GroundTruth1Star
    { 0.65384615384615385, 0.65384615384615385, 0.038461538461538464, 2.9615384615384617, 0.65384615384615385, 0.038461538461538464, 0, 0, 0, 0.61538461538461542, 0.61538461538461542, 0.18589743589743588, 0.18589743589743588, 0.61538461538461542, 0.65384615384615385, 0.65384615384615385}, //GroundTruth1Star
    { 0, 0, 0, 3.6153846153846154, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, //GroundTruth1Star

    //CompRobustAIPRAssociationTest
    { 1.0288461538461537, 1.4230769230769231, 2.0384615384615383, 2.0769230769230771, 2.9615384615384617, 0.46153846153846156, 0.35576923076923078, 1.4230769230769231, 1.5769230769230769, 1.3846153846153846, 1.9230769230769231, 1.344871794871795, 1.344871794871795, 0.42307692307692307, 3.8846153846153846, 5.4615384615384617}, //GroundTruth3BowieHeads
    { 0.57692307692307687, 0.57692307692307687, 0.42307692307692307, 2.8846153846153846, 0.57692307692307687, 0.42307692307692307, 0, 0, 0, 0.46153846153846156, 0.73076923076923073, 0.17435897435897438, 0.17435897435897438, 0.46153846153846156, 0.57692307692307687, 0.57692307692307687}, //GroundTruth3BowieHeads
    { 1.0733333333333333, 1.1666666666666667, 0.32000000000000001, 1.3999999999999999, 2.48, 0.040000000000000001, 0.093333333333333324, 0.28000000000000003, 0.28000000000000003, 0.95999999999999996, 1.24, 0.98866666666666669, 0.98866666666666669, 0.38, 2.7599999999999998, 3.04}, //GroundTruth3BowieHeads
    { 1.1200000000000001, 1.26, 0.32000000000000001, 2.1200000000000001, 1.76, 0.040000000000000001, 0.14000000000000001, 0.28000000000000003, 0.28000000000000003, 0.95999999999999996, 1.24, 0.7693333333333332, 0.7693333333333332, 0.52000000000000002, 2.04, 2.3199999999999998}, //GroundTruth3BowieHeads
    { 1, 1, 0, 1.8799999999999999, 1.72, 0, 0, 0, 0, 0.28000000000000003, 0.40000000000000002, 0.57333333333333336, 0.57333333333333336, 0.20000000000000001, 1.72, 1.72}, //GroundTruth3BowieHeads
    { 0.76000000000000001, 0.76000000000000001, 0.040000000000000001, 2.1200000000000001, 1.48, 0.040000000000000001, 0, 0, 0, 0.68000000000000005, 0.83999999999999997, 0.45666666666666667, 0.45666666666666667, 0.34000000000000002, 1.48, 1.48}, //GroundTruth3BowieHeads
    { 1, 1, 0, 2.6000000000000001, 1, 0, 0, 0, 0, 0.28000000000000003, 0.40000000000000002, 0.39333333333333331, 0.39333333333333331, 0.28000000000000003, 1, 1}, //GroundTruth3BowieHeads
    { 0.76000000000000001, 0.76000000000000001, 0.040000000000000001, 2.8399999999999999, 0.76000000000000001, 0.040000000000000001, 0, 0, 0, 0.68000000000000005, 0.83999999999999997, 0.23333333333333331, 0.23333333333333331, 0.68000000000000005, 0.76000000000000001, 0.76000000000000001}, //GroundTruth3BowieHeads
    { 0.71999999999999997, 0.71999999999999997, 0, 2.8799999999999999, 0.71999999999999997, 0, 0, 0, 0, 0, 0, 0.17200000000000004, 0.17200000000000004, 0, 0.71999999999999997, 0.71999999999999997}, //GroundTruth3BowieHeads
    { 0, 0, 0, 3.6000000000000001, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, //GroundTruth3BowieHeads

    //CompFragmentedAndSwitch
    { 0.32051282051282054, 0.45512820512820518, 2.5769230769230771, 0.23076923076923078, 1.3846153846153846, 2.0384615384615383, 0.19230769230769226, 0.53846153846153844, 0.53846153846153844, 0.19230769230769232, 0.23076923076923078, 0.84615384615384615, 0.84615384615384615, 0.064102564102564097, 1.2692307692307692, 1.8076923076923077}, //GroundTruthBlueGreenBowieHead
    { 0.34615384615384615, 0.34615384615384615, 0.65384615384615385, 0.73076923076923073, 0.34615384615384615, 0.65384615384615385, 0, 0, 0, 0.15384615384615385, 0.19230769230769232, 0.26923076923076922, 0.26923076923076922, 0.15384615384615385, 0.34615384615384615, 0.34615384615384615}, //GroundTruthBlueGreenBowieHead
    { 0.3666666666666667, 0.3666666666666667, 1.4399999999999999, 0.040000000000000001, 1.0800000000000001, 1.4399999999999999, 0, 0, 0, 0.040000000000000001, 0.040000000000000001, 0.76000000000000001, 0.76000000000000001, 0.02, 1.0800000000000001, 1.0800000000000001}, //GroundTruthBlueGreenBowieHead
    { 0.54000000000000004, 0.54000000000000004, 0.71999999999999997, 0.040000000000000001, 1.0800000000000001, 0.71999999999999997, 0, 0, 0, 0.040000000000000001, 0.040000000000000001, 0.76000000000000001, 0.76000000000000001, 0.02, 1.0800000000000001, 1.0800000000000001}, //GroundTruthBlueGreenBowieHead
    { 0.28000000000000003, 0.28000000000000003, 1.2, 0.59999999999999998, 0.52000000000000002, 1.2, 0, 0, 0, 0.040000000000000001, 0.040000000000000001, 0.35999999999999999, 0.35999999999999999, 0.040000000000000001, 0.52000000000000002, 0.52000000000000002}, //GroundTruthBlueGreenBowieHead
    { 0.34999999999999998, 0.34999999999999998, 1.2, 0.69999999999999996, 0.69999999999999996, 1.2, 0, 0, 0, 0, 0, 0.49166666666666659, 0.49166666666666659, 0, 0.69999999999999996, 0.69999999999999996}, //GroundTruthBlueGreenBowieHead
    { 0.52000000000000002, 0.52000000000000002, 0.47999999999999998, 0.59999999999999998, 0.52000000000000002, 0.47999999999999998, 0, 0, 0, 0.040000000000000001, 0.040000000000000001, 0.35999999999999999, 0.35999999999999999, 0.040000000000000001, 0.52000000000000002, 0.52000000000000002}, //GroundTruthBlueGreenBowieHead
    { 0.69999999999999996, 0.69999999999999996, 0.29999999999999999, 0.69999999999999996, 0.69999999999999996, 0.29999999999999999, 0, 0, 0, 0, 0, 0.49166666666666659, 0.49166666666666659, 0, 0.69999999999999996, 0.69999999999999996}, //GroundTruthBlueGreenBowieHead
    { 0, 0, 0.94736842105263153, 1.4736842105263157, 0, 0.94736842105263153, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, //GroundTruthBlueGreenBowieHead
    { 0, 0, 0, 1.4736842105263157, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, //GroundTruthBlueGreenBowieHead

    //Comp1TrackInStar
    { 0.33333333333333331, 0.38141025641025639, 2.4230769230769229, 0, 1.1923076923076923, 2.2307692307692308, 0.096153846153846159, 0.19230769230769232, 0.19230769230769232, 0, 0, 1, 1, 0, 1, 1.1923076923076923}, //GroundTruthRedGreenBowieHeads
    { 1, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1, 1}, //GroundTruthRedGreenBowieHeads
    { 0.064102564102564097, 0.064102564102564097, 2.2307692307692308, 0.80769230769230771, 0.19230769230769232, 2.2307692307692308, 0, 0, 0, 0, 0, 0.19230769230769232, 0.19230769230769232, 0, 0.19230769230769232, 0.19230769230769232}, //GroundTruthRedGreenBowieHeads
    { 0.096153846153846159, 0.096153846153846159, 1.5384615384615385, 0.80769230769230771, 0.19230769230769232, 1.5384615384615385, 0, 0, 0, 0, 0, 0.19230769230769232, 0.19230769230769232, 0, 0.19230769230769232, 0.19230769230769232}, //GroundTruthRedGreenBowieHeads
    { 0.076923076923076927, 0.076923076923076927, 1.5, 0.84615384615384615, 0.15384615384615385, 1.5, 0, 0, 0, 0, 0, 0.15384615384615385, 0.15384615384615385, 0, 0.15384615384615385, 0.15384615384615385}, //GroundTruthRedGreenBowieHeads
    { 0.019230769230769232, 0.019230769230769232, 1.4230769230769231, 0.96153846153846156, 0.038461538461538464, 1.4230769230769231, 0, 0, 0, 0, 0, 0.038461538461538464, 0.038461538461538464, 0, 0.038461538461538464, 0.038461538461538464}, //GroundTruthRedGreenBowieHeads
    { 0.15384615384615385, 0.15384615384615385, 0.80769230769230771, 0.84615384615384615, 0.15384615384615385, 0.80769230769230771, 0, 0, 0, 0, 0, 0.15384615384615385, 0.15384615384615385, 0, 0.15384615384615385, 0.15384615384615385}, //GroundTruthRedGreenBowieHeads
    { 0.038461538461538464, 0.038461538461538464, 0.73076923076923073, 0.96153846153846156, 0.038461538461538464, 0.73076923076923073, 0, 0, 0, 0, 0, 0.038461538461538464, 0.038461538461538464, 0, 0.038461538461538464, 0.038461538461538464}, //GroundTruthRedGreenBowieHeads
    { 0, 0, 0.69230769230769229, 1, 0, 0.69230769230769229, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, //GroundTruthRedGreenBowieHeads
    { 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, //GroundTruthRedGreenBowieHeads

    //CompPerfectGreenBowieHead
    { 0.29487179487179482, 0.43910256410256415, 2.4615384615384617, 0, 1.5384615384615385, 1.8846153846153846, 0.23717948717948717, 0.5, 0.57692307692307687, 0, 0, 1, 1, 0, 0.96153846153846156, 1.5384615384615385}, //GroundTruthRedBlueBowieHead
    { 0.46153846153846156, 0.46153846153846156, 0.53846153846153844, 0.5, 0.46153846153846156, 0.53846153846153844, 0, 0, 0, 0, 0, 0.46153846153846156, 0.46153846153846156, 0, 0.46153846153846156, 0.46153846153846156}, //GroundTruthRedBlueBowieHead
    { 0.47999999999999993, 0.52000000000000002, 1.52, 0, 1.1200000000000001, 1.3999999999999999, 0.059999999999999998, 0.12, 0.12, 0, 0, 1, 1, 0, 1, 1.1200000000000001}, //GroundTruthRedBlueBowieHead
    { 0.59999999999999998, 0.66000000000000003, 0.80000000000000004, 0, 1.1200000000000001, 0.68000000000000005, 0.059999999999999998, 0.12, 0.12, 0, 0, 1, 1, 0, 1, 1.1200000000000001}, //GroundTruthRedBlueBowieHead
    { 0.64000000000000001, 0.64000000000000001, 0.71999999999999997, 0, 1, 0.71999999999999997, 0, 0, 0, 0, 0, 1, 1, 0, 1, 1}, //GroundTruthRedBlueBowieHead
    { 0.059999999999999998, 0.059999999999999998, 1.3999999999999999, 0.88, 0.12, 1.3999999999999999, 0, 0, 0, 0, 0, 0.12, 0.12, 0, 0.12, 0.12}, //GroundTruthRedBlueBowieHead
    { 1, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1, 1}, //GroundTruthRedBlueBowieHead
    { 0.12, 0.12, 0.68000000000000005, 0.88, 0.12, 0.68000000000000005, 0, 0, 0, 0, 0, 0.12, 0.12, 0, 0.12, 0.12}, //GroundTruthRedBlueBowieHead
    { 0, 0, 0.71999999999999997, 1, 0, 0.71999999999999997, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, //GroundTruthRedBlueBowieHead
    { 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, //GroundTruthRedBlueBowieHead

    //Comp1TrackSwitchFromRedToBlue
    { 0.18589743589743588, 0.26282051282051283, 2.6923076923076925, 0, 1.0384615384615385, 2.3846153846153846, 0.12820512820512822, 0.26923076923076922, 0.30769230769230771, 0, 0, 0.75, 0.75, 0, 0.73076923076923073, 1.0384615384615385}, //GroundTruthGreenBowieHead
    { 0.23076923076923078, 0.23076923076923078, 0.76923076923076927, 0.5, 0.23076923076923078, 0.76923076923076927, 0, 0, 0, 0, 0, 0.23076923076923078, 0.23076923076923078, 0, 0.23076923076923078, 0.23076923076923078}, //GroundTruthGreenBowieHead
    { 0.25999999999999995, 0.28666666666666663, 1.76, 0, 0.83999999999999997, 1.6799999999999999, 0.040000000000000001, 0.080000000000000002, 0.080000000000000002, 0, 0, 0.76000000000000001, 0.76000000000000001, 0, 0.76000000000000001, 0.83999999999999997}, //GroundTruthGreenBowieHead
    { 0.26000000000000001, 0.29999999999999999, 1.28, 0.23999999999999999, 0.59999999999999998, 1.2, 0.040000000000000001, 0.080000000000000002, 0.080000000000000002, 0, 0, 0.52000000000000002, 0.52000000000000002, 0, 0.52000000000000002, 0.59999999999999998}, //GroundTruthGreenBowieHead
    { 0.16, 0.16, 1.3999999999999999, 0.44, 0.32000000000000001, 1.3999999999999999, 0, 0, 0, 0, 0, 0.32000000000000001, 0.32000000000000001, 0, 0.32000000000000001, 0.32000000000000001}, //GroundTruthGreenBowieHead
    { 0.5, 0.5, 0.94999999999999996, 0, 0.94999999999999996, 0.94999999999999996, 0, 0, 0, 0, 0, 0.94999999999999996, 0.94999999999999996, 0, 0.94999999999999996, 0.94999999999999996}, //GroundTruthGreenBowieHead
    { 0.080000000000000002, 0.080000000000000002, 0.92000000000000004, 0.68000000000000005, 0.080000000000000002, 0.92000000000000004, 0, 0, 0, 0, 0, 0.080000000000000002, 0.080000000000000002, 0, 0.080000000000000002, 0.080000000000000002}, //GroundTruthGreenBowieHead
    { 0.65000000000000002, 0.65000000000000002, 0.34999999999999998, 0.29999999999999999, 0.65000000000000002, 0.34999999999999998, 0, 0, 0, 0, 0, 0.65000000000000002, 0.65000000000000002, 0, 0.65000000000000002, 0.65000000000000002}, //GroundTruthGreenBowieHead
    { 0.31578947368421051, 0.31578947368421051, 0.63157894736842102, 0.68421052631578949, 0.31578947368421051, 0.63157894736842102, 0, 0, 0, 0, 0, 0.31578947368421051, 0.31578947368421051, 0, 0.31578947368421051, 0.31578947368421051}, //GroundTruthGreenBowieHead
    { 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, //GroundTruthGreenBowieHead

    //Comp1TrackFragmentedOverGreen
    { 0.20833333333333334, 0.27564102564102561, 2.7692307692307692, 0, 0.92307692307692313, 2.5, 0.10897435897435898, 0.23076923076923078, 0.26923076923076922, 0, 0, 0.67307692307692313, 0.67307692307692313, 0, 0.65384615384615385, 0.92307692307692313}, //GroundTruthBlueBowieHead
    { 0.23076923076923078, 0.23076923076923078, 0.76923076923076927, 0.42307692307692307, 0.23076923076923078, 0.76923076923076927, 0, 0, 0, 0, 0, 0.23076923076923078, 0.23076923076923078, 0, 0.23076923076923078, 0.23076923076923078}, //GroundTruthBlueBowieHead
    { 0.34666666666666673, 0.35999999999999999, 1.8400000000000001, 0, 0.71999999999999997, 1.8, 0.02, 0.040000000000000001, 0.040000000000000001, 0, 0, 0.68000000000000005, 0.68000000000000005, 0, 0.68000000000000005, 0.71999999999999997}, //GroundTruthBlueBowieHead
    { 0.41999999999999998, 0.44, 1.1200000000000001, 0, 0.71999999999999997, 1.0800000000000001, 0.02, 0.040000000000000001, 0.040000000000000001, 0, 0, 0.68000000000000005, 0.68000000000000005, 0, 0.68000000000000005, 0.71999999999999997}, //GroundTruthBlueBowieHead
    { 0.46000000000000002, 0.46000000000000002, 1.04, 0, 0.68000000000000005, 1.04, 0, 0, 0, 0, 0, 0.68000000000000005, 0.68000000000000005, 0, 0.68000000000000005, 0.68000000000000005}, //GroundTruthBlueBowieHead
    { 0.02, 0.02, 1.48, 0.64000000000000001, 0.040000000000000001, 1.48, 0, 0, 0, 0, 0, 0.040000000000000001, 0.040000000000000001, 0, 0.040000000000000001, 0.040000000000000001}, //GroundTruthBlueBowieHead
    { 0.68000000000000005, 0.68000000000000005, 0.32000000000000001, 0, 0.68000000000000005, 0.32000000000000001, 0, 0, 0, 0, 0, 0.68000000000000005, 0.68000000000000005, 0, 0.68000000000000005, 0.68000000000000005}, //GroundTruthBlueBowieHead
    { 0.040000000000000001, 0.040000000000000001, 0.76000000000000001, 0.64000000000000001, 0.040000000000000001, 0.76000000000000001, 0, 0, 0, 0, 0, 0.040000000000000001, 0.040000000000000001, 0, 0.040000000000000001, 0.040000000000000001}, //GroundTruthBlueBowieHead
    { 0, 0, 0.71999999999999997, 0.68000000000000005, 0, 0.71999999999999997, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, //GroundTruthBlueBowieHead
    { 0, 0, 0, 0.68000000000000005, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, //GroundTruthBlueBowieHead

    //Comp1TrackOnGreenFrame4to10
    { 0.067307692307692304, 0.13461538461538461, 3.1538461538461537, 0, 0.53846153846153844, 2.8846153846153846, 0.13461538461538461, 0.26923076923076922, 0.26923076923076922, 0, 0, 0.26923076923076922, 0.26923076923076922, 0, 0.26923076923076922, 0.53846153846153844}, //GroundTruthRedBowieHead
    { 0.26923076923076922, 0.26923076923076922, 0.73076923076923073, 0, 0.26923076923076922, 0.73076923076923073, 0, 0, 0, 0, 0, 0.26923076923076922, 0.26923076923076922, 0, 0.26923076923076922, 0.26923076923076922}, //GroundTruthRedBowieHead
    { 0.093333333333333324, 0.093333333333333324, 2.2400000000000002, 0, 0.28000000000000003, 2.2400000000000002, 0, 0, 0, 0, 0, 0.28000000000000003, 0.28000000000000003, 0, 0.28000000000000003, 0.28000000000000003}, //GroundTruthRedBowieHead
    { 0.14000000000000001, 0.14000000000000001, 1.52, 0, 0.28000000000000003, 1.52, 0, 0, 0, 0, 0, 0.28000000000000003, 0.28000000000000003, 0, 0.28000000000000003, 0.28000000000000003}, //GroundTruthRedBowieHead
    { 0.14000000000000001, 0.14000000000000001, 1.4399999999999999, 0, 0.28000000000000003, 1.4399999999999999, 0, 0, 0, 0, 0, 0.28000000000000003, 0.28000000000000003, 0, 0.28000000000000003, 0.28000000000000003}, //GroundTruthRedBowieHead
    { 0, 0, 1.8999999999999999, 0.34999999999999998, 0, 1.8999999999999999, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, //GroundTruthRedBowieHead
    { 0.28000000000000003, 0.28000000000000003, 0.71999999999999997, 0, 0.28000000000000003, 0.71999999999999997, 0, 0, 0, 0, 0, 0.28000000000000003, 0.28000000000000003, 0, 0.28000000000000003, 0.28000000000000003}, //GroundTruthRedBowieHead
    { 0, 0, 1, 0.34999999999999998, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, //GroundTruthRedBowieHead
    { 0, 0, 1, 0.3888888888888889, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, //GroundTruthRedBowieHead
    { 0, 0, 0, 0.69999999999999996, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, //GroundTruthRedBowieHead

    //Comp0Tracks
    { 0, 0, 3.4230769230769229, 0, 0, 3.4230769230769229, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, //GroundTruth0BowieHeads
    { 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, //GroundTruth0BowieHeads
    { 0, 0, 2.52, 0, 0, 2.52, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, //GroundTruth0BowieHeads
    { 0, 0, 1.8, 0, 0, 1.8, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, //GroundTruth0BowieHeads
    { 0, 0, 1.72, 0, 0, 1.72, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, //GroundTruth0BowieHeads
    { 0, 0, 1.8999999999999999, 0, 0, 1.8999999999999999, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, //GroundTruth0BowieHeads
    { 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, //GroundTruth0BowieHeads
    { 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, //GroundTruth0BowieHeads
    { 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, //GroundTruth0BowieHeads
    { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, //GroundTruth0BowieHeads
  };

  testlib_test_start( "test_score_frames_aipr" );
  //string str("");
  //std::ostringstream oss;
  for(int i = 0; i < 10 ; i++)
  {
    cout <<
      "//" << string(computed_trk_files[i]) << "\n" ;
    //Read in computed tracks


    vector<track_sptr> comp_tracks;
    track_reader_process trp("track_reader");
    config_block blk = trp.params();
    blk.set("filename",(string(argv[1])+"/score_tracks_data/CTs/"+string(computed_trk_files[i])+".xml").c_str());
    trp.set_params(blk);
    trp.initialize();
    while(trp.step())
    {
      vector<track_sptr> trp_tracks = trp.tracks();
      comp_tracks.insert(comp_tracks.end(),trp_tracks.begin(),trp_tracks.end());
    }

    for(int j = 0; j < 10; j++)
    {

      vector<frame_based_metrics> fbm;
      //read in ground truth tracks
      vector<vidtk::track_sptr> gt_tracks;
      blk.set("filename",(string(argv[1])+"/score_tracks_data/GTs/"+string(ground_truth_files[j])+".xml").c_str());
      trp.set_params(blk);
      trp.initialize();
      while(trp.step())
      {
        vector<track_sptr> trp_tracks = trp.tracks();
        gt_tracks.insert(gt_tracks.end(),trp_tracks.begin(),trp_tracks.end());
      }

      compute_metrics(fbm,gt_tracks,comp_tracks,0);

      frame_based_metrics avg_fbm;
      avg_fbm.detection_probability_count = 0;
      avg_fbm.detection_probability_presence = 0;
      avg_fbm.false_negatives_count = 0;
      avg_fbm.false_positives_count = 0;
      avg_fbm.merge_fraction = 0;
      avg_fbm.num_merge = 0;
      avg_fbm.num_merge_mult = 0;
      avg_fbm.num_split = 0;
      avg_fbm.num_split_mult = 0;
      avg_fbm.precision_count = 0;
      avg_fbm.precision_presence = 0;
      avg_fbm.split_fraction = 0;
      avg_fbm.true_positives_count = 0;
      avg_fbm.true_positives_presence = 0;
      avg_fbm.gt_with_associations = 0;
      avg_fbm.gt_without_associations = 0;

      for(unsigned fcount = 0; fcount < fbm.size(); ++fcount)
      {
        avg_fbm.detection_probability_count += fbm[fcount].detection_probability_count;
        avg_fbm.detection_probability_presence += fbm[fcount].detection_probability_presence;
        avg_fbm.false_negatives_count += fbm[fcount].false_negatives_count;
        avg_fbm.false_positives_count += fbm[fcount].false_positives_count;
        avg_fbm.merge_fraction += fbm[fcount].merge_fraction;
        avg_fbm.num_merge += fbm[fcount].num_merge;
        avg_fbm.num_merge_mult += fbm[fcount].num_merge_mult;
        avg_fbm.num_split += fbm[fcount].num_split;
        avg_fbm.num_split_mult += fbm[fcount].num_split_mult;
        avg_fbm.precision_count += fbm[fcount].precision_count;
        avg_fbm.precision_presence += fbm[fcount].precision_presence;
        avg_fbm.split_fraction += fbm[fcount].split_fraction;
        avg_fbm.true_positives_count += fbm[fcount].true_positives_count;
        avg_fbm.true_positives_presence += fbm[fcount].true_positives_presence;
        avg_fbm.gt_with_associations += fbm[fcount].gt_with_associations;
        avg_fbm.gt_without_associations += fbm[fcount].gt_without_associations;
      }

      if(fbm.size() != 0)
      {
        avg_fbm.detection_probability_count /= fbm.size();
        avg_fbm.detection_probability_presence /= fbm.size();
        avg_fbm.false_negatives_count /= fbm.size();
        avg_fbm.false_positives_count /= fbm.size();
        avg_fbm.merge_fraction /= fbm.size();
        avg_fbm.num_merge /= fbm.size();
        avg_fbm.num_merge_mult /= fbm.size();
        avg_fbm.num_split /= fbm.size();
        avg_fbm.num_split_mult /= fbm.size();
        avg_fbm.precision_count /= fbm.size();
        avg_fbm.precision_presence /= fbm.size();
        avg_fbm.split_fraction /= fbm.size();
        avg_fbm.true_positives_count /= fbm.size();
        avg_fbm.true_positives_presence /= fbm.size();
        avg_fbm.gt_with_associations /= fbm.size();
        avg_fbm.gt_without_associations /= fbm.size();
      }

      /* Used to generate correct output.
         Must verify it by hand if anything in the scorer changes
      cout << "{" ;
      cout << " " << setprecision(18) << avg_fbm.detection_probability_count;
      cout << ", " << setprecision(18) << avg_fbm.detection_probability_presence ;
      cout << ", " << setprecision(18) << avg_fbm.false_negatives_count ;
      cout << ", " << setprecision(18) << avg_fbm.false_positives_count;
      cout << ", " << setprecision(18) << avg_fbm.gt_with_associations;
      cout << ", " << setprecision(18) << avg_fbm.gt_without_associations;
      cout << ", " << setprecision(18) << avg_fbm.merge_fraction ;
      cout << ", " << setprecision(18) << avg_fbm.num_merge;
      cout << ", " << setprecision(18) << avg_fbm.num_merge_mult;
      cout << ", " << setprecision(18) << avg_fbm.num_split ;
      cout << ", " << setprecision(18) << avg_fbm.num_split_mult ;
      cout << ", " << setprecision(18) << avg_fbm.precision_count;
      cout << ", " << setprecision(18) << avg_fbm.precision_presence ;
      cout << ", " << setprecision(18) << avg_fbm.split_fraction;
      cout << ", " << setprecision(18) << avg_fbm.true_positives_count ;
      cout << ", " << setprecision(18) << avg_fbm.true_positives_presence ;
      cout << "}," ;
      cout << " //" << string(ground_truth_files[i]) << endl ;
      */
      TEST( "detection_probability_count", avg_fbm.detection_probability_count == expected_values[(i*10)+j][0], true );
      TEST( "detection_probability_presence", avg_fbm.detection_probability_presence == expected_values[(i*10)+j][1], true );
      TEST( "false_negatives_count", avg_fbm.false_negatives_count == expected_values[(i*10)+j][2], true );
      TEST( "false_positives_count", avg_fbm.false_positives_count == expected_values[(i*10)+j][3], true );
      TEST( "gt_with_associations", avg_fbm.gt_with_associations == expected_values[(i*10)+j][4], true );
      TEST( "gt_without_associations", avg_fbm.gt_without_associations == expected_values[(i*10)+j][5], true );
      TEST( "merge_fraction", avg_fbm.merge_fraction == expected_values[(i*10)+j][6], true );
      TEST( "num_merge", avg_fbm.num_merge == expected_values[(i*10)+j][7], true );
      TEST( "num_merge_mult", avg_fbm.num_merge_mult == expected_values[(i*10)+j][8], true );
      TEST( "num_split", avg_fbm.num_split == expected_values[(i*10)+j][9], true );
      TEST( "num_split_mult", avg_fbm.num_split_mult == expected_values[(i*10)+j][10], true );
      TEST( "precision_count", avg_fbm.precision_count == expected_values[(i*10)+j][11], true );
      TEST( "precision_presence", avg_fbm.precision_presence == expected_values[(i*10)+j][12], true );
      TEST( "split_fraction", avg_fbm.split_fraction == expected_values[(i*10)+j][13], true );
      TEST( "true_positives_count", avg_fbm.true_positives_count == expected_values[(i*10)+j][14], true );
      TEST( "true_positives_presence", avg_fbm.true_positives_presence == expected_values[(i*10)+j][15], true );

    }
  }
  //cout << oss.str();
  return testlib_test_summary();
}
